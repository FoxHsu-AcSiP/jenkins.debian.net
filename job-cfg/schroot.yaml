- defaults:
        name: schroot-create
        properties:
                - sidebar:
                        url: https://jenkins.debian.net/userContent/about.html
                        text: About jenkins.debian.net
                        icon: /userContent/images/debian-swirl-24x24.png
                - sidebar:
                        url: https://jenkins.debian.net/view/schroot-maint/
                        text: schroot maintainance jobs
                        icon: /userContent/images/debian-jenkins-24x24.png
                - sidebar:
                        url: http://www.profitbricks.com
                        text: Sponsored by Profitbricks
                        icon: /userContent/images/profitbricks-24x24.png
        logrotate:
                daysToKeep: 365
                numToKeep: 365
                artifactDaysToKeep: -1
                artifactNumToKeep: -1
        publishers:
                - email:
                        recipients: jenkins+debian-qa holger@layer-acht.org
        triggers:
                - timed: '{my_time}'
        description: 'Create {my_schroot} schroot.<br>{do_not_edit}'
        block-downstream: yes
        builders:
                - shell: '/srv/jenkins/bin/schroot-create.sh {my_schroot} {my_distro} {my_extra_pkgs}'

- defaults:
        name: schroot-upgrade
        properties:
                - sidebar:
                        url: https://jenkins.debian.net/userContent/about.html
                        text: About jenkins.debian.net
                        icon: /userContent/images/debian-swirl-24x24.png
                - sidebar:
                        url: https://jenkins.debian.net/view/schroot-maint/
                        text: schroot maintainance jobs
                        icon: /userContent/images/debian-jenkins-24x24.png
                - sidebar:
                        url: http://www.profitbricks.com
                        text: Sponsored by Profitbricks
                        icon: /userContent/images/profitbricks-24x24.png
        logrotate:
                daysToKeep: 365
                numToKeep: 365
                artifactDaysToKeep: -1
                artifactNumToKeep: -1
        publishers:
                - email:
                        recipients: jenkins+debian-qa holger@layer-acht.org
        triggers:
                - timed: '{my_time}'
        description: 'Upgrade {my_schroot} schroot.<br>{do_not_edit}'
        block-downstream: yes
        builders:
                - shell: 'schroot -u root -c source:jenkins-{my_schroot} -- apt-get update'
                - shell: 'schroot -u root -c source:jenkins-{my_schroot} -- apt-get -y -u dist-upgrade'
                - shell: 'schroot -u root -c source:jenkins-{my_schroot} -- apt-get --purge autoremove'

- job-template:
        defaults: schroot-create
        name: '{name}-sid-create'

- job-template:
        defaults: schroot-upgrade
        name: '{name}-sid-upgrade'

- job-template:
        defaults: schroot-create
        name: '{name}-haskell-create'

- job-template:
        defaults: schroot-upgrade
        name: '{name}-haskell-upgrade'

- project:
        name: schroot
        do_not_edit: '<br><br>Job configuration source is <a href="http://anonscm.debian.org/gitweb/?p=qa/jenkins.debian.net.git;a=blob;f=job-cfg/schroot.yaml">schroot.yaml</a>.'
        jobs:
                - '{name}-sid-create':
                        my_schroot: sid
                        my_distro: sid
                        my_extra_pkgs: ''
                        my_time: '0 10 * * 2'
                - '{name}-sid-upgrade':
                        my_schroot: sid
                        my_time: '0 11 * * *'
                - '{name}-haskell-create':
                        my_schroot: haskell
                        my_distro: sid
                        my_extra_pkgs: 'cabal-install ghc dctrl-tools patchutils libtext-patch-perl libfile-slurp-perl  libipc-run-perl liblist-moreutils-perl libdpkg-perl'
                        my_time: '0 10 * * 1'
                - '{name}-haskell-upgrade':
                        my_schroot: haskell
                        my_time: '0 11 * * *'

