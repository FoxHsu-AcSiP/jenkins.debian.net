- defaults:
    name: d-i
    project-type: freestyle
    logrotate:
      daysToKeep: 90
      numToKeep: 50
      artifactDaysToKeep: -1
      artifactNumToKeep: -1
    properties:
      - sidebar:
          url: http://jenkins.debian.net/userContent/about.html
          text: About jenkins.debian.net
          icon: /userContent/images/debian-swirl-24x24.png
      - sidebar:
          url: http://jenkins.debian.net/view/debian-installer/
          text: All debian-installer jobs
          icon: /userContent/images/debian-jenkins-24x24.png
      - sidebar:
          url: http://www.profitbricks.com
          text: Sponsored by Profitbricks
          icon: /userContent/images/profitbricks-24x24.png

- defaults:
    name: d-i-manual
    project-type: freestyle
    logrotate:
      daysToKeep: 90
      numToKeep: 50
      artifactDaysToKeep: -1
      artifactNumToKeep: -1
    properties:
      - sidebar:
          url: http://jenkins.debian.net/userContent/about.html
          text: About jenkins.debian.net
          icon: /userContent/images/debian-swirl-24x24.png
      - sidebar:
          url: http://jenkins.debian.net/view/debian-installer/
          text: All debian-installer jobs
          icon: /userContent/images/debian-jenkins-24x24.png
      - sidebar:
          url: http://www.profitbricks.com
          text: Sponsored by Profitbricks
          icon: /userContent/images/profitbricks-24x24.png
    description: 'Builds the {languagename} html version of the installation-guide for all architectures. Triggered by SVN commits to <pre>svn://svn.debian.org/svn/d-i/trunk/manual/{lang}/<pre> {do_not_edit}'
    scm:
      - svn:
         url: svn://svn.debian.org/svn/d-i/trunk
         basedir: .
         workspaceupdater: update
         includedRegions: '/trunk/manual/{lang}/.*'
         excludedRegions: ''
         excludedUsers: ''
         excludedRevprop: ''
         excludedCommitMessages: ''
         viewvc-url: http://anonscm.debian.org/viewvc/d-i/trunk
    builders:
      - shell: '/srv/jenkins/bin/d-i_manual.sh {lang}'
    triggers:
      - pollscm: "*/30 * * * *"
    publishers:
      - logparser:
         rulespath: '/srv/jenkins/logparse/debian.rules'
         unstable_on_warning: 'true'
         fail_on_error: 'true'
      - htmlpublisher:
         name: 'Installation guides with LANG={lang}'
         directory: 'html'
         indexfiles: ''
         keepall: False

- job-template:
    defaults: d-i
    name: '{name}_manual'
    description: 'Builds the installation-guide package. Triggered by SVN commits to <pre>svn://svn.debian.org/svn/d-i/trunk/manual/debian/<pre> {do_not_edit}'
    # FIXME see below, other directories should trigger too
    scm:
      - svn:
         url: svn://svn.debian.org/svn/d-i/trunk
         basedir: .
         workspaceupdater: update
         includedRegions: '{include}'
         excludedRegions: ''
         excludedUsers: ''
         excludedRevprop: ''
         excludedCommitMessages: ''
         viewvc-url: http://anonscm.debian.org/viewvc/d-i/trunk
    builders:
      - shell: '/srv/jenkins/bin/d-i_manual.sh'
    triggers:
      - pollscm: "*/30 * * * *"

- job-template:
    defaults: d-i
    name: '{name}_parse_build_logs'
    description: 'Parses d-i build logs daily. {do_not_edit}'
    builders:
      - shell: '/srv/jenkins/bin/d-i_parse_logs.sh http://d-i.debian.org/daily-images/build-logs.html'
    triggers:
      - timed: "0 5 * * *"
    publishers:
      - logparser:
         rulespath: '/srv/jenkins/logparse/debian.rules'
         unstable_on_warning: 'true'
         fail_on_error: 'true'
      - htmlpublisher:
         name: 'Daily d-i build logs'
         directory: '.'
         indexfiles: 'build-logs.html'
         keepall: True

- job-template:
    defaults: d-i
    name: '{name}_check_jenkins_jobs'
    description: 'Checks daily for missing jenkins jobs. {do_not_edit}'
    builders:
      - shell: '/srv/jenkins/bin/d-i_check_jobs.sh'
    triggers:
      - pollscm: "23 0 * * *"

- job-template:
    defaults: d-i-manual
    name: '{name}_manual_ca'
- job-template:
    defaults: d-i-manual
    name: '{name}_manual_cs'
- job-template:
    defaults: d-i-manual
    name: '{name}_manual_de'
- job-template:
    defaults: d-i-manual
    name: '{name}_manual_en'
- job-template:
    defaults: d-i-manual
    name: '{name}_manual_eu'
- job-template:
    defaults: d-i-manual
    name: '{name}_manual_fr'
- job-template:
    defaults: d-i-manual
    name: '{name}_manual_it'
- job-template:
    defaults: d-i-manual
    name: '{name}_manual_po'
- job-template:
    defaults: d-i-manual
    name: '{name}_manual_pt_BR'

- project:
    name: d-i
    do_not_edit: '<br><br>Configured by <a href="http://jenkins.debian.net/userContent/about.html">jenkins-job-builder</a>, do not edit this job through the web UI.'
    jobs:
      - '{name}_manual':
         include: '/trunk/manual/debian/.*'
         # FIXME: misses: scripts doc build
      - '{name}_manual_ca':
         lang: 'ca'
         languagename: 'Catalan'
      - '{name}_manual_cs':
         lang: 'cs'
         languagename: 'Czech'
      - '{name}_manual_de':
         lang: 'de'
         languagename: 'German'
      - '{name}_manual_en':
         lang: 'en'
         languagename: 'English'
      - '{name}_manual_eu':
         lang: 'eu'
         languagename: 'Basque'
      - '{name}_manual_fr':
         lang: 'fr'
         languagename: 'French'
      - '{name}_manual_it':
         lang: 'it'
         languagename: 'Italian'
      - '{name}_manual_po':
         lang: 'po'
         languagename: 'Polish'
      - '{name}_manual_pt_BR':
         lang: 'pt_BR'
         languagename: 'Brazilian Portuguese'
      # FIXME: a housekeeping job, ie to check for new languages
      - '{name}_parse_build_logs'
      - '{name}_check_jenkins_jobs'

