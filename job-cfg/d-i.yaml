- defaults:
    name: d-i
    project-type: freestyle
    logrotate:
      daysToKeep: 90
      numToKeep: 50
      artifactDaysToKeep: -1
      artifactNumToKeep: -1
    properties:
      - sidebar:
          url: http://jenkins.debian.net/userContent/about.html
          text: About jenkins.debian.net
          icon: /userContent/images/debian-swirl-24x24.png
      - sidebar:
          url: http://jenkins.debian.net/view/debian-installer/
          text: All debian-installer jobs
          icon: /userContent/images/debian-jenkins-24x24.png
      - sidebar:
          url: http://www.profitbricks.com
          text: Sponsored by Profitbricks
          icon: /userContent/images/profitbricks-24x24.png

- job-template:
    defaults: d-i
    name: '{name}_manual'
    description: 'Builds the installation-guide packages.{do_not_edit}'
    scm:
      - svn:
         url: svn://svn.debian.org/svn/d-i/trunk
         basedir: .
         workspaceupdater: update
         includedRegions: '{include}'
         excludedRegions: ''
         excludedUsers: ''
         excludedRevprop: ''
         excludedCommitMessages: ''
         viewvc-url: http://anonscm.debian.org/viewvc/d-i/trunk
    builders:
      - shell: '/srv/jenkins/bin/d-i_manual.sh'
    triggers:
      - pollscm: "*/30 * * * *"

- job-template:
    defaults: d-i
    name: '{name}_manual_{lang}'
    description: 'Builds the {languagename} html version of the installation-guide for all architectures.{do_not_edit}'
    scm:
      - svn:
         url: svn://svn.debian.org/svn/d-i/trunk
         basedir: .
         workspaceupdater: update
         includedRegions: '/trunk/manual/{lang}/.*'
         excludedRegions: ''
         excludedUsers: ''
         excludedRevprop: ''
         excludedCommitMessages: ''
         viewvc-url: http://anonscm.debian.org/viewvc/d-i/trunk
    builders:
      - shell: '/srv/jenkins/bin/d-i_manual.sh {lang}'
    triggers:
      - pollscm: "*/30 * * * *"
    publishers:
      - logparser:
         rulespath: '/srv/jenkins/logparse/debian.rules'
         unstable_on_warning: 'true'
         fail_on_error: 'true'
      - htmlpublisher:
         name: 'Installation guides with LANG={lang}'
         directory: 'html'
         indexfiles: ''
         keepall: False

- job-template:
    defaults: d-i
    name: '{name}_parse_build_logs'
    description: 'Parses d-i build logs.{do_not_edit}'
    builders:
      - shell: '/srv/jenkins/bin/d-i_parse_logs.sh http://d-i.debian.org/daily-images/build-logs.html'
    triggers:
      - timed: "0 5 * * *"
    publishers:
      - logparser:
         rulespath: '/srv/jenkins/logparse/debian.rules'
         unstable_on_warning: 'true'
         fail_on_error: 'true'
      - htmlpublisher:
         name: 'Daily d-i build logs'
         directory: '.'
         indexfiles: 'build-logs.html'
         keepall: True

- project:
    name: d-i
    do_not_edit: '<br><br>Configured by <a href="http://jenkins.debian.net/userContent/about.html">jenkins-job-builder</a>, do not edit this job through the web UI.'
    jobs:
      - '{name}_manual':
         include: '/trunk/manual/debian/.*'
         # FIXME: misses: scripts doc build
      - '{name}_manual_ca':
         lang: 'ca'
         languagename: 'Catalan'
      - '{name}_manual_de':
         lang: 'de'
         languagename: 'German'
      - '{name}_manual_es':
         lang: 'es'
         languagename: 'Spanish'
      - '{name}_manual_fi':
         lang: 'fi'
         languagename: 'Finnish'
      - '{name}_manual_fr':
         lang: 'fr'
         languagename: 'French'
      - '{name}_manual_hu':
         lang: 'hu'
         languagename: 'Hungarian'
      - '{name}_manual_it':
         lang: 'it'
         languagename: 'Italian'
      - '{name}_manual_ja':
         lang: 'ja'
         languagename: 'Japanese'
      - '{name}_manual_ko':
         lang: 'ko'
         languagename: 'Korean'
      - '{name}_manual_nl':
         lang: 'nl'
         languagename: 'Dutch'
      - '{name}_manual_pt':
         lang: 'pt'
         languagename: 'Portuguese'
      - '{name}_manual_pt_BR':
         lang: 'pr_BR'
         languagename: 'Brazilian Portuguese'
      - '{name}_manual_sv':
         lang: 'sv'
         languagename: 'Swedish'
      - '{name}_manual_vi':
         lang: 'vi'
         languagename: 'Vietnamese'
      - '{name}_manual_zh_CN':
         lang: 'zh_CN'
         languagename: 'Chinese'
      # FIXME: a housekeeping job, ie to check for new languages
      - '{name}_parse_build_logs'

